ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"sd.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.xchg_byte,"ax",%progbits
  18              		.align	1
  19              		.global	xchg_byte
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	xchg_byte:
  27              	.LVL0:
  28              	.LFB132:
  29              		.file 1 "Core/Src/sd.c"
   1:Core/Src/sd.c **** #include "sd.h"
   2:Core/Src/sd.c **** 
   3:Core/Src/sd.c **** /* MMC/SD command */
   4:Core/Src/sd.c **** #define CMD0 (0)           /* GO_IDLE_STATE */
   5:Core/Src/sd.c **** #define CMD1 (1)           /* SEND_OP_COND (MMC) */
   6:Core/Src/sd.c **** #define ACMD41 (0x80 + 41) /* SEND_OP_COND (SDC) */
   7:Core/Src/sd.c **** #define CMD8 (8)           /* SEND_IF_COND */
   8:Core/Src/sd.c **** #define CMD9 (9)           /* SEND_CSD */
   9:Core/Src/sd.c **** #define CMD10 (10)         /* SEND_CID */
  10:Core/Src/sd.c **** #define CMD12 (12)         /* STOP_TRANSMISSION */
  11:Core/Src/sd.c **** #define CMD13 (13)
  12:Core/Src/sd.c **** #define ACMD13 (0x80 + 13) /* SD_STATUS (SDC) */
  13:Core/Src/sd.c **** #define CMD16 (16)         /* SET_BLOCKLEN */
  14:Core/Src/sd.c **** #define CMD17 (17)         /* READ_SINGLE_BLOCK */
  15:Core/Src/sd.c **** #define CMD18 (18)         /* READ_MULTIPLE_BLOCK */
  16:Core/Src/sd.c **** #define CMD23 (23)         /* SET_BLOCK_COUNT (MMC) */
  17:Core/Src/sd.c **** #define ACMD23 (0x80 + 23) /* SET_WR_BLK_ERASE_COUNT (SDC) */
  18:Core/Src/sd.c **** #define CMD24 (24)         /* WRITE_BLOCK */
  19:Core/Src/sd.c **** #define CMD25 (25)         /* WRITE_MULTIPLE_BLOCK */
  20:Core/Src/sd.c **** #define CMD32 (32)         /* ERASE_ER_BLK_START */
  21:Core/Src/sd.c **** #define CMD33 (33)         /* ERASE_ER_BLK_END */
  22:Core/Src/sd.c **** #define CMD38 (38)         /* ERASE */
  23:Core/Src/sd.c **** #define CMD55 (55)         /* APP_CMD */
  24:Core/Src/sd.c **** #define CMD58 (58)         /* READ_OCR */
  25:Core/Src/sd.c **** 
  26:Core/Src/sd.c **** /*Fetch SPI_CS_PIN high or low*/
  27:Core/Src/sd.c **** #define CS_HIGH()                                                    \
  28:Core/Src/sd.c ****     {                                                                \
  29:Core/Src/sd.c ****         HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_SET); \
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 2


  30:Core/Src/sd.c ****     }
  31:Core/Src/sd.c **** #define CS_LOW()                                                       \
  32:Core/Src/sd.c ****     {                                                                  \
  33:Core/Src/sd.c ****         HAL_GPIO_WritePin(SD_CS_GPIO_Port, SD_CS_Pin, GPIO_PIN_RESET); \
  34:Core/Src/sd.c ****     }
  35:Core/Src/sd.c **** //(Note that the _256 is used as a mask to clear the prescalar bits as it provides binary 111 in th
  36:Core/Src/sd.c **** #define FCLK_SLOW()                                                                                
  37:Core/Src/sd.c ****     {                                                                                              
  38:Core/Src/sd.c ****         MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRATEPRESCALER_12
  39:Core/Src/sd.c ****     } /* Set SCLK = slow, approx 280 KBits/s*/
  40:Core/Src/sd.c **** #define FCLK_FAST()                                                                                
  41:Core/Src/sd.c ****     {                                                                                              
  42:Core/Src/sd.c ****         MODIFY_REG(SD_SPI_HANDLE.Instance->CR1, SPI_BAUDRATEPRESCALER_256, SPI_BAUDRATEPRESCALER_8)
  43:Core/Src/sd.c ****     } /* Set SCLK = fast, approx 4.5 MBits/s */
  44:Core/Src/sd.c **** 
  45:Core/Src/sd.c **** /*Exchange a single byte through spi communication */
  46:Core/Src/sd.c **** UINT8 xchg_byte(UINT8 xmitData)
  47:Core/Src/sd.c **** {
  30              		.loc 1 47 1 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 16
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		.loc 1 47 1 is_stmt 0 view .LVU1
  35 0000 00B5     		push	{lr}
  36              	.LCFI0:
  37              		.cfi_def_cfa_offset 4
  38              		.cfi_offset 14, -4
  39 0002 87B0     		sub	sp, sp, #28
  40              	.LCFI1:
  41              		.cfi_def_cfa_offset 32
  42 0004 8DF80F00 		strb	r0, [sp, #15]
  48:Core/Src/sd.c ****     UINT8 rcvData;
  43              		.loc 1 48 5 is_stmt 1 view .LVU2
  49:Core/Src/sd.c ****     HAL_SPI_TransmitReceive(&SD_SPI_HANDLE, &xmitData, &rcvData, 1, 50);
  44              		.loc 1 49 5 view .LVU3
  45 0008 3223     		movs	r3, #50
  46 000a 0093     		str	r3, [sp]
  47 000c 0123     		movs	r3, #1
  48 000e 0DF11702 		add	r2, sp, #23
  49 0012 0DF10F01 		add	r1, sp, #15
  50 0016 0448     		ldr	r0, .L3
  51              	.LVL1:
  52              		.loc 1 49 5 is_stmt 0 view .LVU4
  53 0018 FFF7FEFF 		bl	HAL_SPI_TransmitReceive
  54              	.LVL2:
  50:Core/Src/sd.c ****     return rcvData;
  55              		.loc 1 50 5 is_stmt 1 view .LVU5
  51:Core/Src/sd.c **** }
  56              		.loc 1 51 1 is_stmt 0 view .LVU6
  57 001c 9DF81700 		ldrb	r0, [sp, #23]	@ zero_extendqisi2
  58 0020 07B0     		add	sp, sp, #28
  59              	.LCFI2:
  60              		.cfi_def_cfa_offset 4
  61              		@ sp needed
  62 0022 5DF804FB 		ldr	pc, [sp], #4
  63              	.L4:
  64 0026 00BF     		.align	2
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 3


  65              	.L3:
  66 0028 00000000 		.word	hspi2
  67              		.cfi_endproc
  68              	.LFE132:
  70              		.section	.text.sd_wait_ready,"ax",%progbits
  71              		.align	1
  72              		.global	sd_wait_ready
  73              		.syntax unified
  74              		.thumb
  75              		.thumb_func
  76              		.fpu fpv4-sp-d16
  78              	sd_wait_ready:
  79              	.LFB133:
  52:Core/Src/sd.c **** 
  53:Core/Src/sd.c **** /*Wait until the sd card is ready or timeout*/
  54:Core/Src/sd.c **** UINT8 sd_wait_ready(void)
  55:Core/Src/sd.c **** {
  80              		.loc 1 55 1 is_stmt 1 view -0
  81              		.cfi_startproc
  82              		@ args = 0, pretend = 0, frame = 0
  83              		@ frame_needed = 0, uses_anonymous_args = 0
  84 0000 10B5     		push	{r4, lr}
  85              	.LCFI3:
  86              		.cfi_def_cfa_offset 8
  87              		.cfi_offset 4, -8
  88              		.cfi_offset 14, -4
  56:Core/Src/sd.c ****     UINT16 timeout = 0xFFF;
  89              		.loc 1 56 5 view .LVU8
  90              	.LVL3:
  91              		.loc 1 56 12 is_stmt 0 view .LVU9
  92 0002 40F6FF74 		movw	r4, #4095
  93              	.LVL4:
  94              	.L7:
  57:Core/Src/sd.c ****     UINT8 data;
  95              		.loc 1 57 5 is_stmt 1 discriminator 2 view .LVU10
  58:Core/Src/sd.c ****     do
  96              		.loc 1 58 5 discriminator 2 view .LVU11
  59:Core/Src/sd.c ****     {
  60:Core/Src/sd.c ****         data = xchg_byte(SD_DUMMY_BYTE);
  97              		.loc 1 60 9 discriminator 2 view .LVU12
  98              		.loc 1 60 16 is_stmt 0 discriminator 2 view .LVU13
  99 0006 FF20     		movs	r0, #255
 100 0008 FFF7FEFF 		bl	xchg_byte
 101              	.LVL5:
  61:Core/Src/sd.c ****     } while (data != 0xFF && --timeout);
 102              		.loc 1 61 13 is_stmt 1 discriminator 2 view .LVU14
 103              		.loc 1 61 5 is_stmt 0 discriminator 2 view .LVU15
 104 000c FF28     		cmp	r0, #255
 105 000e 03D0     		beq	.L6
 106              		.loc 1 61 27 discriminator 1 view .LVU16
 107 0010 013C     		subs	r4, r4, #1
 108              	.LVL6:
 109              		.loc 1 61 27 discriminator 1 view .LVU17
 110 0012 A4B2     		uxth	r4, r4
 111              	.LVL7:
 112              		.loc 1 61 27 discriminator 1 view .LVU18
 113 0014 002C     		cmp	r4, #0
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 4


 114 0016 F6D1     		bne	.L7
 115              	.L6:
  62:Core/Src/sd.c ****     return (data == 0xFF) ? 1 : 0;
 116              		.loc 1 62 5 is_stmt 1 view .LVU19
  63:Core/Src/sd.c **** }
 117              		.loc 1 63 1 is_stmt 0 view .LVU20
 118 0018 FF28     		cmp	r0, #255
 119 001a 14BF     		ite	ne
 120 001c 0020     		movne	r0, #0
 121              	.LVL8:
 122              		.loc 1 63 1 view .LVU21
 123 001e 0120     		moveq	r0, #1
 124 0020 10BD     		pop	{r4, pc}
 125              		.loc 1 63 1 view .LVU22
 126              		.cfi_endproc
 127              	.LFE133:
 129              		.section	.text.sd_deselect,"ax",%progbits
 130              		.align	1
 131              		.global	sd_deselect
 132              		.syntax unified
 133              		.thumb
 134              		.thumb_func
 135              		.fpu fpv4-sp-d16
 137              	sd_deselect:
 138              	.LFB134:
  64:Core/Src/sd.c **** 
  65:Core/Src/sd.c **** /*inactivate spi communication*/
  66:Core/Src/sd.c **** void sd_deselect(void)
  67:Core/Src/sd.c **** {
 139              		.loc 1 67 1 is_stmt 1 view -0
 140              		.cfi_startproc
 141              		@ args = 0, pretend = 0, frame = 0
 142              		@ frame_needed = 0, uses_anonymous_args = 0
 143 0000 08B5     		push	{r3, lr}
 144              	.LCFI4:
 145              		.cfi_def_cfa_offset 8
 146              		.cfi_offset 3, -8
 147              		.cfi_offset 14, -4
  68:Core/Src/sd.c ****     CS_HIGH();
 148              		.loc 1 68 5 view .LVU24
 149 0002 0122     		movs	r2, #1
 150 0004 4FF48051 		mov	r1, #4096
 151 0008 0348     		ldr	r0, .L11
 152 000a FFF7FEFF 		bl	HAL_GPIO_WritePin
 153              	.LVL9:
 154              		.loc 1 68 14 view .LVU25
  69:Core/Src/sd.c ****     xchg_byte(SD_DUMMY_BYTE);
 155              		.loc 1 69 5 view .LVU26
 156 000e FF20     		movs	r0, #255
 157 0010 FFF7FEFF 		bl	xchg_byte
 158              	.LVL10:
  70:Core/Src/sd.c **** }
 159              		.loc 1 70 1 is_stmt 0 view .LVU27
 160 0014 08BD     		pop	{r3, pc}
 161              	.L12:
 162 0016 00BF     		.align	2
 163              	.L11:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 5


 164 0018 00040048 		.word	1207960576
 165              		.cfi_endproc
 166              	.LFE134:
 168              		.section	.text.sd_select,"ax",%progbits
 169              		.align	1
 170              		.global	sd_select
 171              		.syntax unified
 172              		.thumb
 173              		.thumb_func
 174              		.fpu fpv4-sp-d16
 176              	sd_select:
 177              	.LFB135:
  71:Core/Src/sd.c **** 
  72:Core/Src/sd.c **** /*activate spi communication*/
  73:Core/Src/sd.c **** UINT8 sd_select(void)
  74:Core/Src/sd.c **** {
 178              		.loc 1 74 1 is_stmt 1 view -0
 179              		.cfi_startproc
 180              		@ args = 0, pretend = 0, frame = 0
 181              		@ frame_needed = 0, uses_anonymous_args = 0
 182 0000 10B5     		push	{r4, lr}
 183              	.LCFI5:
 184              		.cfi_def_cfa_offset 8
 185              		.cfi_offset 4, -8
 186              		.cfi_offset 14, -4
  75:Core/Src/sd.c ****     /*pull down the CS to select the sd card*/
  76:Core/Src/sd.c ****     CS_LOW();
 187              		.loc 1 76 5 view .LVU29
 188 0002 0022     		movs	r2, #0
 189 0004 4FF48051 		mov	r1, #4096
 190 0008 0748     		ldr	r0, .L18
 191 000a FFF7FEFF 		bl	HAL_GPIO_WritePin
 192              	.LVL11:
 193              		.loc 1 76 13 view .LVU30
  77:Core/Src/sd.c ****     xchg_byte(SD_DUMMY_BYTE);
 194              		.loc 1 77 5 view .LVU31
 195 000e FF20     		movs	r0, #255
 196 0010 FFF7FEFF 		bl	xchg_byte
 197              	.LVL12:
  78:Core/Src/sd.c ****     if (sd_wait_ready())
 198              		.loc 1 78 5 view .LVU32
 199              		.loc 1 78 9 is_stmt 0 view .LVU33
 200 0014 FFF7FEFF 		bl	sd_wait_ready
 201              	.LVL13:
 202              		.loc 1 78 8 view .LVU34
 203 0018 10B1     		cbz	r0, .L17
  79:Core/Src/sd.c ****     {
  80:Core/Src/sd.c ****         return 1;
 204              		.loc 1 80 16 view .LVU35
 205 001a 0124     		movs	r4, #1
 206              	.L14:
  81:Core/Src/sd.c ****     }
  82:Core/Src/sd.c ****     else
  83:Core/Src/sd.c ****     {
  84:Core/Src/sd.c ****         /*select fail with no valid response*/
  85:Core/Src/sd.c ****         /*timeout*/
  86:Core/Src/sd.c ****         sd_deselect();
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 6


  87:Core/Src/sd.c ****         return 0;
  88:Core/Src/sd.c ****     }
  89:Core/Src/sd.c **** }
 207              		.loc 1 89 1 view .LVU36
 208 001c 2046     		mov	r0, r4
 209 001e 10BD     		pop	{r4, pc}
 210              	.L17:
 211 0020 0446     		mov	r4, r0
  86:Core/Src/sd.c ****         return 0;
 212              		.loc 1 86 9 is_stmt 1 view .LVU37
 213 0022 FFF7FEFF 		bl	sd_deselect
 214              	.LVL14:
  87:Core/Src/sd.c ****     }
 215              		.loc 1 87 9 view .LVU38
  87:Core/Src/sd.c ****     }
 216              		.loc 1 87 16 is_stmt 0 view .LVU39
 217 0026 F9E7     		b	.L14
 218              	.L19:
 219              		.align	2
 220              	.L18:
 221 0028 00040048 		.word	1207960576
 222              		.cfi_endproc
 223              	.LFE135:
 225              		.section	.text.send_cmd,"ax",%progbits
 226              		.align	1
 227              		.syntax unified
 228              		.thumb
 229              		.thumb_func
 230              		.fpu fpv4-sp-d16
 232              	send_cmd:
 233              	.LVL15:
 234              	.LFB136:
  90:Core/Src/sd.c **** 
  91:Core/Src/sd.c **** /*return command response token*/
  92:Core/Src/sd.c **** static __R1_Res_Status send_cmd(UINT8 cmd, UINT32 arg)
  93:Core/Src/sd.c **** {
 235              		.loc 1 93 1 is_stmt 1 view -0
 236              		.cfi_startproc
 237              		@ args = 0, pretend = 0, frame = 0
 238              		@ frame_needed = 0, uses_anonymous_args = 0
 239              		.loc 1 93 1 is_stmt 0 view .LVU41
 240 0000 38B5     		push	{r3, r4, r5, lr}
 241              	.LCFI6:
 242              		.cfi_def_cfa_offset 16
 243              		.cfi_offset 3, -16
 244              		.cfi_offset 4, -12
 245              		.cfi_offset 5, -8
 246              		.cfi_offset 14, -4
 247 0002 0446     		mov	r4, r0
 248 0004 0D46     		mov	r5, r1
  94:Core/Src/sd.c ****     UINT8 res;
 249              		.loc 1 94 5 is_stmt 1 view .LVU42
  95:Core/Src/sd.c ****     UINT8 crc;
 250              		.loc 1 95 5 view .LVU43
  96:Core/Src/sd.c ****     if (cmd & 0x80)
 251              		.loc 1 96 5 view .LVU44
 252              		.loc 1 96 8 is_stmt 0 view .LVU45
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 7


 253 0006 10F0800F 		tst	r0, #128
 254 000a 28D1     		bne	.L29
 255              	.LVL16:
 256              	.L21:
  97:Core/Src/sd.c ****     {
  98:Core/Src/sd.c ****         /*ACMD commands*/
  99:Core/Src/sd.c ****         cmd &= 0x7F;
 100:Core/Src/sd.c ****         res = send_cmd(CMD55, 0);
 101:Core/Src/sd.c ****         if (res > 1)
 102:Core/Src/sd.c ****         {
 103:Core/Src/sd.c ****             /*Illegal command response not 0*/
 104:Core/Src/sd.c ****             return (__R1_Res_Status)res;
 105:Core/Src/sd.c ****         }
 106:Core/Src/sd.c ****     }
 107:Core/Src/sd.c **** 
 108:Core/Src/sd.c ****     /*reset communication status*/
 109:Core/Src/sd.c ****     sd_deselect();
 257              		.loc 1 109 5 is_stmt 1 view .LVU46
 258 000c FFF7FEFF 		bl	sd_deselect
 259              	.LVL17:
 110:Core/Src/sd.c ****     if (!sd_select())
 260              		.loc 1 110 5 view .LVU47
 261              		.loc 1 110 10 is_stmt 0 view .LVU48
 262 0010 FFF7FEFF 		bl	sd_select
 263              	.LVL18:
 264              		.loc 1 110 8 view .LVU49
 265 0014 80B3     		cbz	r0, .L25
 111:Core/Src/sd.c ****     {
 112:Core/Src/sd.c ****         /*Select fail*/
 113:Core/Src/sd.c ****         return WAITING_NO_RESPONSE;
 114:Core/Src/sd.c ****     }
 115:Core/Src/sd.c **** 
 116:Core/Src/sd.c ****     /*Send command packet*/
 117:Core/Src/sd.c ****     xchg_byte(0x40 | cmd);
 266              		.loc 1 117 5 is_stmt 1 view .LVU50
 267 0016 44F04000 		orr	r0, r4, #64
 268 001a FFF7FEFF 		bl	xchg_byte
 269              	.LVL19:
 118:Core/Src/sd.c ****     xchg_byte((UINT8)(arg >> 24));
 270              		.loc 1 118 5 view .LVU51
 271 001e 280E     		lsrs	r0, r5, #24
 272 0020 FFF7FEFF 		bl	xchg_byte
 273              	.LVL20:
 119:Core/Src/sd.c ****     xchg_byte((UINT8)(arg >> 16));
 274              		.loc 1 119 5 view .LVU52
 275 0024 C5F30740 		ubfx	r0, r5, #16, #8
 276 0028 FFF7FEFF 		bl	xchg_byte
 277              	.LVL21:
 120:Core/Src/sd.c ****     xchg_byte((UINT8)(arg >> 8));
 278              		.loc 1 120 5 view .LVU53
 279 002c C5F30720 		ubfx	r0, r5, #8, #8
 280 0030 FFF7FEFF 		bl	xchg_byte
 281              	.LVL22:
 121:Core/Src/sd.c ****     xchg_byte((UINT8)arg);
 282              		.loc 1 121 5 view .LVU54
 283 0034 E8B2     		uxtb	r0, r5
 284 0036 FFF7FEFF 		bl	xchg_byte
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 8


 285              	.LVL23:
 122:Core/Src/sd.c **** 
 123:Core/Src/sd.c ****     /*crc + stop byte*/
 124:Core/Src/sd.c ****     switch (cmd)
 286              		.loc 1 124 5 view .LVU55
 287 003a CCB1     		cbz	r4, .L26
 288 003c 082C     		cmp	r4, #8
 289 003e 19D1     		bne	.L27
 125:Core/Src/sd.c ****     {
 126:Core/Src/sd.c ****     case CMD0:
 127:Core/Src/sd.c ****         crc = 0X95;
 128:Core/Src/sd.c ****         break;
 129:Core/Src/sd.c ****     case CMD8:
 130:Core/Src/sd.c ****         crc = 0x87;
 290              		.loc 1 130 13 is_stmt 0 view .LVU56
 291 0040 8720     		movs	r0, #135
 292              	.L23:
 293              	.LVL24:
 131:Core/Src/sd.c ****         break;
 132:Core/Src/sd.c ****     /*dummy crc + stop byte*/
 133:Core/Src/sd.c ****     default:
 134:Core/Src/sd.c ****         crc = 0x01;
 135:Core/Src/sd.c ****     }
 136:Core/Src/sd.c ****     /*send crc + stop byte*/
 137:Core/Src/sd.c ****     xchg_byte(crc);
 294              		.loc 1 137 5 is_stmt 1 view .LVU57
 295 0042 FFF7FEFF 		bl	xchg_byte
 296              	.LVL25:
 138:Core/Src/sd.c **** 
 139:Core/Src/sd.c ****     /*recieve  R1 response*/
 140:Core/Src/sd.c ****     UINT8 cnt;
 297              		.loc 1 140 5 view .LVU58
 141:Core/Src/sd.c ****     cnt = 10;
 298              		.loc 1 141 5 view .LVU59
 299              		.loc 1 141 9 is_stmt 0 view .LVU60
 300 0046 0A24     		movs	r4, #10
 301              	.LVL26:
 302              	.L24:
 142:Core/Src/sd.c ****     do
 303              		.loc 1 142 5 is_stmt 1 discriminator 2 view .LVU61
 143:Core/Src/sd.c ****     {
 144:Core/Src/sd.c ****         /*wait for response by sending dummy byte*/
 145:Core/Src/sd.c ****         res = xchg_byte(SD_DUMMY_BYTE);
 304              		.loc 1 145 9 discriminator 2 view .LVU62
 305              		.loc 1 145 15 is_stmt 0 discriminator 2 view .LVU63
 306 0048 FF20     		movs	r0, #255
 307 004a FFF7FEFF 		bl	xchg_byte
 308              	.LVL27:
 146:Core/Src/sd.c ****         /*The left bit(MSB) of R1 response is always 0*/
 147:Core/Src/sd.c ****     } while ((res & 0x80) && --cnt);
 309              		.loc 1 147 13 is_stmt 1 discriminator 2 view .LVU64
 310              		.loc 1 147 5 is_stmt 0 discriminator 2 view .LVU65
 311 004e 10F0800F 		tst	r0, #128
 312 0052 03D0     		beq	.L22
 313              		.loc 1 147 27 discriminator 1 view .LVU66
 314 0054 631E     		subs	r3, r4, #1
 315              	.LVL28:
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 9


 316              		.loc 1 147 27 discriminator 1 view .LVU67
 317 0056 13F0FF04 		ands	r4, r3, #255
 318 005a F5D1     		bne	.L24
 319              	.LVL29:
 320              	.L22:
 148:Core/Src/sd.c **** 
 149:Core/Src/sd.c ****     return (__R1_Res_Status)res;
 150:Core/Src/sd.c **** }
 321              		.loc 1 150 1 view .LVU68
 322 005c 38BD     		pop	{r3, r4, r5, pc}
 323              	.LVL30:
 324              	.L29:
  99:Core/Src/sd.c ****         res = send_cmd(CMD55, 0);
 325              		.loc 1 99 9 is_stmt 1 view .LVU69
  99:Core/Src/sd.c ****         res = send_cmd(CMD55, 0);
 326              		.loc 1 99 13 is_stmt 0 view .LVU70
 327 005e 00F07F04 		and	r4, r0, #127
 328              	.LVL31:
 100:Core/Src/sd.c ****         if (res > 1)
 329              		.loc 1 100 9 is_stmt 1 view .LVU71
 100:Core/Src/sd.c ****         if (res > 1)
 330              		.loc 1 100 15 is_stmt 0 view .LVU72
 331 0062 0021     		movs	r1, #0
 332              	.LVL32:
 100:Core/Src/sd.c ****         if (res > 1)
 333              		.loc 1 100 15 view .LVU73
 334 0064 3720     		movs	r0, #55
 335 0066 FFF7CBFF 		bl	send_cmd
 336              	.LVL33:
 101:Core/Src/sd.c ****         {
 337              		.loc 1 101 9 is_stmt 1 view .LVU74
 101:Core/Src/sd.c ****         {
 338              		.loc 1 101 12 is_stmt 0 view .LVU75
 339 006a 0128     		cmp	r0, #1
 340 006c CED9     		bls	.L21
 341 006e F5E7     		b	.L22
 342              	.LVL34:
 343              	.L26:
 124:Core/Src/sd.c ****     {
 344              		.loc 1 124 5 view .LVU76
 345 0070 9520     		movs	r0, #149
 346 0072 E6E7     		b	.L23
 347              	.L27:
 134:Core/Src/sd.c ****     }
 348              		.loc 1 134 13 view .LVU77
 349 0074 0120     		movs	r0, #1
 350 0076 E4E7     		b	.L23
 351              	.L25:
 113:Core/Src/sd.c ****     }
 352              		.loc 1 113 16 view .LVU78
 353 0078 8020     		movs	r0, #128
 354 007a EFE7     		b	.L22
 355              		.cfi_endproc
 356              	.LFE136:
 358              		.section	.text.SD_GoIdleState,"ax",%progbits
 359              		.align	1
 360              		.global	SD_GoIdleState
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 10


 361              		.syntax unified
 362              		.thumb
 363              		.thumb_func
 364              		.fpu fpv4-sp-d16
 366              	SD_GoIdleState:
 367              	.LFB137:
 151:Core/Src/sd.c **** 
 152:Core/Src/sd.c **** __R1_Res_Status SD_GoIdleState(void)
 153:Core/Src/sd.c **** {
 368              		.loc 1 153 1 is_stmt 1 view -0
 369              		.cfi_startproc
 370              		@ args = 0, pretend = 0, frame = 0
 371              		@ frame_needed = 0, uses_anonymous_args = 0
 372 0000 10B5     		push	{r4, lr}
 373              	.LCFI7:
 374              		.cfi_def_cfa_offset 8
 375              		.cfi_offset 4, -8
 376              		.cfi_offset 14, -4
 154:Core/Src/sd.c ****     __R1_Res_Status res;
 377              		.loc 1 154 5 view .LVU80
 155:Core/Src/sd.c ****     /*Pull down the CS voltage*/
 156:Core/Src/sd.c ****     res = send_cmd(CMD0, 0);
 378              		.loc 1 156 5 view .LVU81
 379              		.loc 1 156 11 is_stmt 0 view .LVU82
 380 0002 0021     		movs	r1, #0
 381 0004 0846     		mov	r0, r1
 382 0006 FFF7FEFF 		bl	send_cmd
 383              	.LVL35:
 384 000a 0446     		mov	r4, r0
 385              	.LVL36:
 157:Core/Src/sd.c ****     /*R1 response in idle state*/
 158:Core/Src/sd.c ****     if (res == IDLE_STATE)
 386              		.loc 1 158 5 is_stmt 1 view .LVU83
 387              		.loc 1 158 8 is_stmt 0 view .LVU84
 388 000c 0128     		cmp	r0, #1
 389 000e 01D0     		beq	.L33
 390              	.LVL37:
 391              	.L31:
 159:Core/Src/sd.c ****     {
 160:Core/Src/sd.c ****         CS_HIGH();
 161:Core/Src/sd.c ****         xchg_byte(SD_DUMMY_BYTE);
 162:Core/Src/sd.c ****     }
 163:Core/Src/sd.c ****     return res;
 392              		.loc 1 163 5 is_stmt 1 view .LVU85
 164:Core/Src/sd.c **** }
 393              		.loc 1 164 1 is_stmt 0 view .LVU86
 394 0010 2046     		mov	r0, r4
 395 0012 10BD     		pop	{r4, pc}
 396              	.LVL38:
 397              	.L33:
 160:Core/Src/sd.c ****         xchg_byte(SD_DUMMY_BYTE);
 398              		.loc 1 160 9 is_stmt 1 view .LVU87
 399 0014 0122     		movs	r2, #1
 400 0016 4FF48051 		mov	r1, #4096
 401 001a 0348     		ldr	r0, .L34
 402              	.LVL39:
 160:Core/Src/sd.c ****         xchg_byte(SD_DUMMY_BYTE);
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 11


 403              		.loc 1 160 9 is_stmt 0 view .LVU88
 404 001c FFF7FEFF 		bl	HAL_GPIO_WritePin
 405              	.LVL40:
 160:Core/Src/sd.c ****         xchg_byte(SD_DUMMY_BYTE);
 406              		.loc 1 160 18 is_stmt 1 view .LVU89
 161:Core/Src/sd.c ****     }
 407              		.loc 1 161 9 view .LVU90
 408 0020 FF20     		movs	r0, #255
 409 0022 FFF7FEFF 		bl	xchg_byte
 410              	.LVL41:
 411 0026 F3E7     		b	.L31
 412              	.L35:
 413              		.align	2
 414              	.L34:
 415 0028 00040048 		.word	1207960576
 416              		.cfi_endproc
 417              	.LFE137:
 419              		.section	.text.SD_Init,"ax",%progbits
 420              		.align	1
 421              		.global	SD_Init
 422              		.syntax unified
 423              		.thumb
 424              		.thumb_func
 425              		.fpu fpv4-sp-d16
 427              	SD_Init:
 428              	.LFB138:
 165:Core/Src/sd.c **** 
 166:Core/Src/sd.c **** __R1_Res_Status SD_Init(void)
 167:Core/Src/sd.c **** {
 429              		.loc 1 167 1 view -0
 430              		.cfi_startproc
 431              		@ args = 0, pretend = 0, frame = 0
 432              		@ frame_needed = 0, uses_anonymous_args = 0
 433 0000 10B5     		push	{r4, lr}
 434              	.LCFI8:
 435              		.cfi_def_cfa_offset 8
 436              		.cfi_offset 4, -8
 437              		.cfi_offset 14, -4
 168:Core/Src/sd.c ****     __R1_Res_Status res;
 438              		.loc 1 168 5 view .LVU92
 169:Core/Src/sd.c ****     FCLK_SLOW();
 439              		.loc 1 169 5 view .LVU93
 440 0002 0E4B     		ldr	r3, .L40
 441 0004 1A68     		ldr	r2, [r3]
 442 0006 1368     		ldr	r3, [r2]
 443 0008 23F03803 		bic	r3, r3, #56
 444 000c 43F03003 		orr	r3, r3, #48
 445 0010 1360     		str	r3, [r2]
 446              		.loc 1 169 16 view .LVU94
 170:Core/Src/sd.c **** 
 171:Core/Src/sd.c ****     /*Pull up MOSI and CS voltage high in at least 74 clock*/
 172:Core/Src/sd.c ****     HAL_Delay(1);
 447              		.loc 1 172 5 view .LVU95
 448 0012 0120     		movs	r0, #1
 449 0014 FFF7FEFF 		bl	HAL_Delay
 450              	.LVL42:
 173:Core/Src/sd.c ****     CS_HIGH();
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 12


 451              		.loc 1 173 5 view .LVU96
 452 0018 0122     		movs	r2, #1
 453 001a 4FF48051 		mov	r1, #4096
 454 001e 0848     		ldr	r0, .L40+4
 455 0020 FFF7FEFF 		bl	HAL_GPIO_WritePin
 456              	.LVL43:
 457              		.loc 1 173 14 view .LVU97
 174:Core/Src/sd.c ****     for (int i = 0; i < 10; i++)
 458              		.loc 1 174 5 view .LVU98
 459              	.LBB2:
 460              		.loc 1 174 10 view .LVU99
 461              		.loc 1 174 14 is_stmt 0 view .LVU100
 462 0024 0024     		movs	r4, #0
 463              		.loc 1 174 5 view .LVU101
 464 0026 03E0     		b	.L37
 465              	.LVL44:
 466              	.L38:
 175:Core/Src/sd.c ****     {
 176:Core/Src/sd.c ****         /*send at least 80 dummy byte*/
 177:Core/Src/sd.c ****         xchg_byte(SD_DUMMY_BYTE);
 467              		.loc 1 177 9 is_stmt 1 discriminator 3 view .LVU102
 468 0028 FF20     		movs	r0, #255
 469 002a FFF7FEFF 		bl	xchg_byte
 470              	.LVL45:
 174:Core/Src/sd.c ****     for (int i = 0; i < 10; i++)
 471              		.loc 1 174 29 discriminator 3 view .LVU103
 174:Core/Src/sd.c ****     for (int i = 0; i < 10; i++)
 472              		.loc 1 174 30 is_stmt 0 discriminator 3 view .LVU104
 473 002e 0134     		adds	r4, r4, #1
 474              	.LVL46:
 475              	.L37:
 174:Core/Src/sd.c ****     for (int i = 0; i < 10; i++)
 476              		.loc 1 174 21 is_stmt 1 discriminator 1 view .LVU105
 174:Core/Src/sd.c ****     for (int i = 0; i < 10; i++)
 477              		.loc 1 174 5 is_stmt 0 discriminator 1 view .LVU106
 478 0030 092C     		cmp	r4, #9
 479 0032 F9DD     		ble	.L38
 480              	.LBE2:
 178:Core/Src/sd.c ****     }
 179:Core/Src/sd.c ****     res = SD_GoIdleState();
 481              		.loc 1 179 5 is_stmt 1 view .LVU107
 482              		.loc 1 179 11 is_stmt 0 view .LVU108
 483 0034 FFF7FEFF 		bl	SD_GoIdleState
 484              	.LVL47:
 180:Core/Src/sd.c ****     return res;
 485              		.loc 1 180 5 is_stmt 1 view .LVU109
 181:Core/Src/sd.c **** }
 486              		.loc 1 181 1 is_stmt 0 view .LVU110
 487 0038 10BD     		pop	{r4, pc}
 488              	.LVL48:
 489              	.L41:
 490              		.loc 1 181 1 view .LVU111
 491 003a 00BF     		.align	2
 492              	.L40:
 493 003c 00000000 		.word	hspi2
 494 0040 00040048 		.word	1207960576
 495              		.cfi_endproc
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 13


 496              	.LFE138:
 498              		.text
 499              	.Letext0:
 500              		.file 2 "d:\\msys64\\mingw64\\arm-none-eabi\\include\\machine\\_default_types.h"
 501              		.file 3 "d:\\msys64\\mingw64\\arm-none-eabi\\include\\sys\\_stdint.h"
 502              		.file 4 "Drivers/CMSIS/Device/ST/STM32G4xx/Include/stm32g431xx.h"
 503              		.file 5 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_def.h"
 504              		.file 6 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_gpio.h"
 505              		.file 7 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_dma.h"
 506              		.file 8 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal_spi.h"
 507              		.file 9 "Core/Inc/sd.h"
 508              		.file 10 "Core/Inc/main.h"
 509              		.file 11 "Drivers/STM32G4xx_HAL_Driver/Inc/stm32g4xx_hal.h"
ARM GAS  C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s 			page 14


DEFINED SYMBOLS
                            *ABS*:0000000000000000 sd.c
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:18     .text.xchg_byte:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:26     .text.xchg_byte:0000000000000000 xchg_byte
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:66     .text.xchg_byte:0000000000000028 $d
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:71     .text.sd_wait_ready:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:78     .text.sd_wait_ready:0000000000000000 sd_wait_ready
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:130    .text.sd_deselect:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:137    .text.sd_deselect:0000000000000000 sd_deselect
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:164    .text.sd_deselect:0000000000000018 $d
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:169    .text.sd_select:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:176    .text.sd_select:0000000000000000 sd_select
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:221    .text.sd_select:0000000000000028 $d
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:226    .text.send_cmd:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:232    .text.send_cmd:0000000000000000 send_cmd
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:359    .text.SD_GoIdleState:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:366    .text.SD_GoIdleState:0000000000000000 SD_GoIdleState
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:415    .text.SD_GoIdleState:0000000000000028 $d
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:420    .text.SD_Init:0000000000000000 $t
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:427    .text.SD_Init:0000000000000000 SD_Init
C:\Users\Falle\AppData\Local\Temp\ccyjRwon.s:493    .text.SD_Init:000000000000003c $d

UNDEFINED SYMBOLS
HAL_SPI_TransmitReceive
hspi2
HAL_GPIO_WritePin
HAL_Delay
